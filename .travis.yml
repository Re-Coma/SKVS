sudo: required

#language: cpp
#compiler: gcc
#os: linux

services:
  - docker

branches:
  only:
    - master

before_install: #change to centos
  - sudo apt-get update
  - echo 'DOCKER_OPTS="-H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock -s devicemapper"' | sudo tee /etc/default/docker > /dev/null
  - sudo service docker restart
  - sleep 5
  - sudo docker pull weldpua2008/docker-ansible:${OS_TYPE}${OS_VERSION}_v${ANSIBLE_VERSION}


#install:
  #protoc
  #- curl -L https://github.com/google/protobuf/releases/download/v3.9.0/protoc-3.9.0-linux-x86_64.zip -o /tmp/protoc.zip
  #- unzip /tmp/protoc.zip -d "$HOME"/protoc
  #- mkdir -p "$HOME"/src && ln -s "$HOME"/protoc "$HOME"/src/protobuf
  #- sudo apt-get install libprotobuf-dev protobuf-compiler
  #- sudo apt-get install libprotoc-dev
  
env:
  matrix: #change to centos
    - OS_TYPE=centos OS_VERSION=6 ANSIBLE_VERSION=1.9.2
  #- PATH=$HOME/protoc/bin:$PATH

script:
  - sudo docker run --rm=true -v `pwd`:/ansible-apache:rw weldpua2008/docker-ansible:${OS_TYPE}${OS_VERSION}_v${ANSIBLE_VERSION} /bin/bash -c "/ansible-apache/tests/test-in-docker-image.sh ${OS_TYPE} ${OS_VERSION} ${ANSIBLE_VERSION}" 
  #- source /etc/profile
  #- make all

notifications:
  email: false

#before_install:
#    - eval "${MATRIX_EVAL}"